// Pledge by Zac Lovoy
(function(e,t,n,r){var i=function(t,n){this.elem=t;this.$elem=e(t);this.options=n};i.prototype={defaults:{sourceAddress:null,coinbaseKey:null,coinbaseSecret:null,embedlyKey:null,backgroundColor:"#348EDA",textColor:"white",bottomText:"Like This?  Contribute A Donation With Coinbase!",topText:"",currencyType:"BTC",marginPercentage:15,update:false},init:function(){if(typeof this.options!="undefined"&&this.options.update!="undefined"&&this.options.update){var t=this.getUpdateData();this.config=e.extend({},t,this.options)}else{this.config=e.extend({},this.defaults,this.options);this.recallDataTagData()}this.build();this.saveValues();return this},build:function(){var t=this.$elem;var n=this.config;e.embedly.defaults.key=this.config.embedlyKey;this.$elem.addClass("pledge");this.$elem.css("background-color",this.config.backgroundColor);this.$elem.css("color",this.config.textColor);this.$elem.css("margin-left",this.config.marginPercentage+"%");this.$elem.css("margin-right",this.config.marginPercentage+"%");this.$elem.html("<div class='pledgeTop'>"+this.config.topText+"</div><div class='pledgeContent'><a href='"+this.config.sourceAddress+"' id='pledgeLink' ></a></div><div id='pledgeBox'></div><br />");this.$elem.find("#pledgeLink").embedly({display:function(t){if(t.type==="video"||t.type==="rich"){var n=(t.height/t.width*100).toPrecision(4)+"%";var r=e('<div class="responsive-object">').css({paddingBottom:n});r.html(t.html);e(this).replaceWith(r)}else{var n=(t.height/t.width*100).toPrecision(4)+"%";var r=e('<div class="responsive-object">').css({paddingBottom:n});r.html("<img class='embedImage' src='"+t.url+"'></img>");e(this).replaceWith(r)}}});this.$elem.find("#pledgeBox").html("<div id='pledgeLogin'></div><div id='pledgeCoinbaseBox' class='pledgeHidden'></div>");this.$elem.find("#pledgeLogin").html("<div id='pledgeLoginText'>"+this.config.bottomText+"<br /><form class='form-inline'>Amount ("+n.currencyType+"): <input type='text' id='pledgeAmountBox' class='form-control'>&nbsp;&nbsp;&nbsp;<input type='button' class='btn btn-inverse' id='pledgeLogInButton' value='Submit'></form></div>");if(this.config.sourceAddress==null){this.$elem.find(".pledgeTop").css("min-height",5);this.$elem.find(".pledgeContent").empty();this.$elem.css("min-height",100)}this.$elem.find("#pledgeLogInButton").click(function(r){var i=t.find("#pledgeAmountBox").val();var s="lib/proxy.php?key="+n.coinbaseKey+"&secret="+n.coinbaseSecret+"&amount="+i+"&currency="+n.currencyType;var o="";var u=e.getJSON(s,function(e){}).done(function(e){o=e.button.code;t.find("#pledgeCoinbaseBox").html("<iframe src='https://coinbase.com/inline_payments/"+o+"' style='height: 160px; width: 100%; border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.25);' scrolling='no' allowtransparency='true' frameborder='0'></iframe><br /><input type='button' class='btn btn-danger' id='pledgeCancelButton' value='Back'>");t.find("#pledgeCancelButton").css("width","100%");t.find("#pledgeLogin").slideUp(function(){t.find("#pledgeCoinbaseBox").slideDown()});t.find("#pledgeCancelButton").click(function(e){t.find("#pledgeCoinbaseBox").slideUp(function(){t.find("#pledgeCoinbaseBox").empty();t.find("#pledgeLogin").slideDown();t.find("#pledgeLogin").css("display","block")});e.stopPropagation()});r.stopPropagation()})})},recallDataTagData:function(){if(this.$elem.attr("data-embedlyKey")!=null){this.config.embedlyKey=this.$elem.attr("data-embedlyKey")}if(this.$elem.attr("data-sourceAddress")!=null){this.config.sourceAddress=this.$elem.attr("data-sourceAddress")}if(this.$elem.attr("data-coinbaseKey")!=null){this.config.coinbaseKey=this.$elem.attr("data-coinbaseKey")}if(this.$elem.attr("data-coinbaseSecret")!=null){this.config.coinbaseSecret=this.$elem.attr("data-coinbaseSecret")}if(this.$elem.attr("data-backgroundColor")!=null){this.config.backgroundColor=this.$elem.attr("data-backgroundColor")}if(this.$elem.attr("data-textColor")!=null){this.config.textColor=this.$elem.attr("data-textColor")}if(this.$elem.attr("data-bottomText")!=null){this.config.bottomText=this.$elem.attr("data-bottomText")}if(this.$elem.attr("data-topText")!=null){this.config.topText=this.$elem.attr("data-topText")}if(this.$elem.attr("data-currencyType")!=null){this.config.currencyType=this.$elem.attr("data-currencyType")}if(this.$elem.attr("data-marginPercentage")!=null){this.config.marginPercentage=this.$elem.attr("data-marginPercentage")}},clearValues:function(){this.$elem.removeData("sourceAddress").removeData("coinbaseKey").removeData("coinbaseSecret").removeData("embedlyKey").removeData("backgroundColor").removeData("textColor").removeData("bottomText").removeData("topText").removeData("currencyType").removeData("marginPercentage")},destroy:function(){this.$elem.find("#pledgeLogInButton").unbind("click");this.$elem.find("#pledgeCancelButton").unbind("click");this.clearValues();this.$elem.remove()},clear:function(){this.$elem.find("#pledgeLogInButton").unbind("click");this.$elem.find("#pledgeCancelButton").unbind("click");this.clearValues();this.$elem.removeClass("pledge");this.$elem.empty()},getUpdateData:function(){var e={sourceAddress:this.$elem.data("sourceAddress"),coinbaseKey:this.$elem.data("coinbaseKey"),coinbaseSecret:this.$elem.data("coinbaseSecret"),embedlyKey:this.$elem.data("embedlyKey"),backgroundColor:this.$elem.data("backgroundColor"),textColor:this.$elem.data("textColor"),bottomText:this.$elem.data("bottomText"),topText:this.$elem.data("topText"),currencyType:this.$elem.data("currencyType"),marginPercentage:this.$elem.data("marginPercentage"),update:false};return e},saveValues:function(){this.$elem.data("sourceAddress",this.config.sourceAddress).data("coinbaseKey",this.config.coinbaseKey).data("coinbaseSecret",this.config.coinbaseSecret).data("embedlyKey",this.config.embedlyKey).data("backgroundColor",this.config.backgroundColor).data("textColor",this.config.textColor).data("bottomText",this.config.bottomText).data("topText",this.config.topText).data("currencyType",this.config.currencyType).data("marginPercentage",this.config.marginPercentage)}};e.fn.pledge=function(e){if(e==="clear"){(new i(this,e)).clear()}else if(e==="destroy"){(new i(this,e)).destroy()}else{return this.each(function(){(new i(this,e)).init()})}}})(jQuery,window,document)